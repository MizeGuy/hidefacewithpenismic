<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird with Coins (Pine Tree Obstacles, Swipe Gif, & Kolkar)</title>
  <style>
    /* RESET & LAYOUT */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      background: url('main/brill.png') no-repeat center center;
      background-size: cover;
      overflow: hidden;
    }
    #Canvas {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* HEADER */
    #Header {
      position: absolute;
      top: 1vh;
      left: 50%;
      transform: translateX(-50%);
      color: rgb(255, 0, 0);
      font-weight: bold;
      text-decoration: underline;
      font-size: 1.5vw; /* Scales with viewport width */
      z-index: 9999;
    }

    /* PLAYER (Birdy) – Original 456×256, now responsive */
    #Birdy {
      position: absolute;
      top: 40%;
      left: 20%;
      width: 15vw; /* Scales with viewport width */
      height: 8.44vh; /* Maintains 456/256 aspect ratio: 15vw * (256/456) */
      max-width: 200px; /* Prevent oversized on large screens */
      max-height: 112px;
      min-width: 50px; /* Prevent too small on small screens */
      min-height: 28px;
      background-image: url('main/player.avif');
      background-size: cover;
      background-position: center;
      z-index: 150;
    }
    .FallenBirdy {
      transform: rotate(90deg);
    }

    /* COINS – Original 294×225, now responsive */
    .Coin {
      position: absolute;
      width: 10vw;
      height: 7.65vh; /* Maintains 294/225 aspect ratio: 10vw * (225/294) */
      max-width: 150px;
      max-height: 115px;
      min-width: 40px;
      min-height: 30px;
      background-image: url('main/boostlogo.png');
      background-repeat: no-repeat;
      background-size: cover;
      left: 100%;
      z-index: 140;
      animation-timing-function: linear;
    }

    /* PINE TREE OBSTACLES */
    .Pipe {
      position: absolute;
      top: 0;
      left: 100%;
      width: 5vw; /* Reduced from 5% for better scaling */
      max-width: 80px;
      min-width: 20px;
      background: linear-gradient(to bottom, #228B22 0%, #228B22 90%, #8B4513 90%, #8B4513 100%);
      border: 0.2vw solid #444; /* Scaled border */
      border-radius: 0.6vw;
      animation-timing-function: linear;
    }
    .TopPipe {
      transform: rotate(180deg);
    }

    @keyframes PipeMovement {
      from { left: 100%; }
      to   { left: -25%; }
    }
    @keyframes CoinMovement {
      from { left: 100%; }
      to   { left: -10%; }
    }
    .paused {
      animation-play-state: paused;
    }

    /* SCORE & INSTRUCTIONS */
    #InstructionBox {
      position: absolute;
      left: 50%;
      top: 35%;
      display: none;
    }
    #InstructionBox div {
      position: relative;
      left: -50%;
      z-index: 150;
      color: white;
      font-size: 2vw;
      background: rgba(0,0,0,0.3);
      padding: 1vw 2vw;
      border-radius: 0.8vw;
    }
    .noSelect {
      user-select: none;
      -webkit-user-select: none;
    }
    #CurrentScoreCard {
      position: relative;
      left: -50%;
      top: 40%;
      text-align: center;
      font-size: 4vw;
      color: white;
      text-shadow: -0.2vw -0.2vw 0 #000, 0.2vw -0.2vw 0 #000, -0.2vw 0.2vw 0 #000, 0.2vw 0.2vw 0 #000;
      z-index: 50;
    }
    #LostScoreScreen {
      position: relative;
      left: -50%;
      margin-top: -70%;
      padding: 1vw 1.5vw;
      background: #ded895;
      border-radius: 0.4vw;
      border: 0.2vw solid black;
      text-align: center;
      display: none;
      font-size: 2vw;
      color: white;
      text-shadow: -0.2vw -0.2vw 0 #000, 0.2vw -0.2vw 0 #000, -0.2vw 0.2vw 0 #000, 0.2vw 0.2vw 0 #000;
      z-index: 150;
    }

    /* Extra Text */
    #ExtraText {
      margin-top: 1vh;
      font-size: 1.2vw;
      color: #222;
    }
    #ExtraText strong, #ExtraText span {
      display: block;
      margin-bottom: 0.5vh;
    }

    /* PAUSE BUTTON */
    #PauseButton {
      position: absolute;
      top: 2vh;
      right: 1vw;
      width: 3vw;
      max-width: 40px;
      min-width: 20px;
      background: orange;
      border-radius: 0.5vw;
      font-size: 2.6vw;
      text-align: center;
      z-index: 50;
      cursor: pointer;
      padding: 0.8vh 0;
    }

    /* CHASER – Original 800×800, now responsive */
    #Chaser {
      position: absolute;
      top: 40%;
      left: -5%;
      width: 25vw;
      height: 25vh; /* Square aspect ratio */
      max-width: 300px;
      max-height: 300px;
      min-width: 100px;
      min-height: 100px;
      background-image: url('main/chaser.JPG');
      background-size: cover;
      background-position: center;
      z-index: 100;
      outline: 0.2vw solid purple;
    }

    /* SWIPE GIF */
    #SwipeGif {
      position: absolute;
      top: 1vh;
      left: 50%;
      transform: translateX(-50%);
      width: 15vw;
      height: 5vh;
      max-width: 200px;
      max-height: 100px;
      background-image: url('main/swipe.gif');
      background-size: cover;
      display: none;
      z-index: 999;
    }

    /* KOLKAR – Original 800×700, now responsive */
    .Kolkar {
      position: absolute;
      top: 40%;
      left: 100%;
      width: 25vw;
      height: 21.875vh; /* Maintains 800/700 aspect ratio: 25vw * (700/800) */
      max-width: 300px;
      max-height: 262px;
      min-width: 100px;
      min-height: 87px;
      background-image: url('main/russellfat.png');
      background-size: cover;
      background-position: center;
      z-index: 160;
      animation-timing-function: linear;
    }

    @keyframes KolkarMovement {
      from { left: 100%; }
      to   { left: -15%; }
    }
  </style>
</head>
<body>
  <div id="Header">Made By TheMizeGuy</div>
  <div id="Canvas">
    <div id="InstructionBox">
      <div class="noSelect">Click to Fly<br>Space Bar to Reset<br>"P" to Pause</div>
    </div>
    <div style="position: absolute; left: 50%; top: 50%;">
      <div id="CurrentScoreCard" class="noSelect"><span id="CurrentScore">0</span></div>
    </div>
    <div style="position: absolute; left: 50%; top: 50%;">
      <div id="LostScoreScreen" class="noSelect">
        <span>Score</span><br><span id="FinalScore">0</span><br>
        <span>Best</span><br><span id="BestScore">0</span><br><br>
        <button id="ResetButton" type="button">Reset</button>
        <div id="ExtraText">
          <strong>FlappyCuck</strong>
          <span>Left click to jump</span>
          <span>Collect that G2G delivery to slow down the ROACH!</span>
          <span>Special surprise at 50 points!</span>
        </div>
      </div>
    </div>
    <div id="DebugInfo" class="noSelect"></div>
    <div id="Birdy"></div>
    <div id="PauseButton" class="noSelect">||</div>
    <div id="Chaser"></div>
    <div id="SwipeGif"></div>
  </div>

  <script src="main/jquery.min.js"></script>
  <script>
    $(function(){
      var canvasObject = $('#Canvas');
      var gameLoopIntervalID = 0;
      var Paused = true;
      var Lost = false;
      var CurrentScore = 0;
      var gameLoopCounter = 0;
      var pipeDuration = 20;
      var chaseX = -10;
      var chaseSpeed = 0.027;
      var chaseTop = 40;
      var chaseTrackFactor = 0.05;

      var isMuted = false;
      var flapCount = 0;
      var ohSound = new Audio('main/oh.mp3'); ohSound.volume = 0.01;
      var jammerSound = new Audio('main/jammer.mp3'); jammerSound.loop = true; jammerSound.volume = 0.1;
      var nowaybroSound = new Audio('main/nowaybro.mp3'); nowaybroSound.volume = 0.1;
      var impactSound = new Audio('main/LightningShieldImpact.ogg'); impactSound.volume = 0.01;

      var Birdy = new (function(){
        var selectorObject = $('#Birdy');
        var jumping = false;
        var gravVeloc = 0;
        var gravAccel = 0.3;
        var terminalVelocity = 10;
        var Angle = 0;

        this.Reset = function(){
          jumping = false; gravVeloc = 0; Angle = 0; flapCount = 0;
          selectorObject.stop().rotate(0).css({ top: '40%', left: '20%' });
        };
        this.fall = function(){
          if(!jumping){
            selectorObject.stop().animate({top: '+='+gravVeloc+'%'}, 30, 'linear');
            gravVeloc += gravAccel;
            if(gravVeloc > terminalVelocity) gravVeloc = terminalVelocity;
            var newAngle = Angle + 15*Math.pow((gravVeloc/terminalVelocity),2);
            adjustAngle(Math.min(newAngle, 90));
          } else gravVeloc = 0;
        };
        this.jump = function(){
          if(Paused) return;
          jumping = true; flapCount++;
          if(flapCount % 4 === 0 && !isMuted) { ohSound.currentTime = 0; ohSound.play(); }
          adjustAngle(-45);
          selectorObject.stop().animate({top: '-=9%'}, 100, 'linear', function(){
            jumping = false; Birdy.fall();
          });
        };
        function adjustAngle(angle){
          selectorObject.rotate(angle); Angle = angle;
        }
        this.BirdyObject = selectorObject;
      })();

      function startGame() {
        if(Lost) return;
        gameLoopIntervalID = setInterval(gameLoop, 30);
        $('.Pipe, .Coin, .Kolkar').removeClass('paused');
        $('#PauseButton').text('||');
        Paused = false;
      }
      function pauseGame() {
        clearInterval(gameLoopIntervalID);
        $('.Pipe, .Coin, .Kolkar').addClass('paused');
        $('#PauseButton').text('▶');
        Paused = true;
      }
      function togglePause() { if(!Paused) pauseGame(); else startGame(); }
      function endGame() {
        Lost = true; pauseGame();
        var cookieScore = parseInt(getCookie('HighScore') || 0, 10);
        var highScore = Math.max(CurrentScore, cookieScore);
        setCookie('HighScore', highScore, 9999);
        Birdy.BirdyObject.animate({top: '90%'}, 1500, 'linear');
        $('#FinalScore').text(CurrentScore); $('#BestScore').text(highScore);
        $('#LostScoreScreen').slideDown();
        if(!isMuted) { nowaybroSound.currentTime = 0; nowaybroSound.play(); }
      }
      function resetGame() {
        pauseGame(); $('.Pipe, .Coin, .Kolkar').remove();
        Lost = false; CurrentScore = 0; gameLoopCounter = 0; pipeDuration = 15;
        chaseX = -10; chaseSpeed = 0.017; chaseTop = 40;
        $('#Chaser').css({ left: chaseX + '%', top: chaseTop + '%' });
        Birdy.Reset(); $('#LostScoreScreen').slideUp();
        nextKolkarSpawn = getKolkarSpawnTime();
        startGame();
      }

      var pipeSpawnInterval = 55;
      var coinSpawnInterval = 44;
      var coinSpawnOffset = 22;

      function startJammerFadeIn(){
        if(isMuted || Lost) return;
        jammerSound.volume = 0; jammerSound.currentTime = 0; jammerSound.play();
        var totalDuration = 10000, steps = 50, stepTime = totalDuration / steps, finalVol = 0.15;
        var volIncrement = finalVol / steps;
        clearInterval(jammerFadeInterval);
        jammerFadeInterval = setInterval(function(){
          if(isMuted || Lost || jammerSound.paused) {
            clearInterval(jammerFadeInterval); return;
          }
          var newVol = jammerSound.volume + volIncrement;
          if(newVol >= finalVol) { newVol = finalVol; clearInterval(jammerFadeInterval); }
          jammerSound.volume = newVol;
        }, stepTime);
      }

      var nextKolkarSpawn = 0;
      function getKolkarSpawnTime(){ return gameLoopCounter + Math.floor(Math.random() * 80) + 75; }
      function addKolkar(){
        var topVal = 10 + Math.random()*60;
        var $kolkar = $('<div/>').addClass('Kolkar').css({
          top: topVal + '%',
          animation: 'KolkarMovement 6s linear'
        }).appendTo(canvasObject);
        if(!isMuted) { impactSound.currentTime = 0; impactSound.play(); setTimeout(() => { impactSound.pause(); impactSound.currentTime = 0; }, 2000); }
      }
      function cleanKolkar(){
        $('.Kolkar').each(function(){ if($(this).offset().left / $(this).parent().width() < -0.3) $(this).remove(); });
      }

      function addPipe(){
        var PipeGap = 45, MinPipeHeight = 5, MaxTopHeight = 100 - PipeGap - 2*MinPipeHeight;
        var TopPipeHeight = Math.random()*MaxTopHeight + MinPipeHeight;
        var BottomTop = TopPipeHeight + PipeGap, BottomHeight = 100 - BottomTop;
        $('<div/>').addClass('Pipe TopPipe').css({ height: TopPipeHeight + '%', animation: 'PipeMovement ' + pipeDuration + 's linear' }).data('scored', false).appendTo(canvasObject);
        $('<div/>').addClass('Pipe').css({ height: BottomHeight + '%', top: BottomTop + '%', animation: 'PipeMovement ' + pipeDuration + 's linear' }).data('scored', false).appendTo(canvasObject);
      }
      function cleanPipes(){
        $('.Pipe').each(function(){ if($(this).offset().left / $(this).parent().width() < -0.2) $(this).remove(); });
      }

      function addCoin(){
        var coinTop = 20 + Math.random()*60;
        $('<div/>').addClass('Coin').css({ top: coinTop + '%', animation: 'CoinMovement ' + pipeDuration + 's linear' }).appendTo(canvasObject);
      }
      function cleanCoins(){
        $('.Coin').each(function(){ if($(this).offset().left / $(this).parent().width() < -0.2) $(this).remove(); });
      }

      function updateChaser(){
        if(!Lost && !Paused){
          chaseX += chaseSpeed;
          if(chaseX >= 20) { endGame(); return; }
          var birdTopPercent = getTopPercent($('#Birdy'));
          var diff = birdTopPercent - chaseTop;
          chaseTop += chaseTrackFactor * diff;
          $('#Chaser').css({ left: chaseX + '%', top: chaseTop + '%' });
        }
      }

      function gameLoop(){
        if(gameLoopCounter % 2 === 0){
          incrementScore(); checkCollisions(); checkCoinCollisions(); checkKolkarCollisions();
        }
        isInBound(Birdy.BirdyObject, canvasObject); Birdy.fall();
        if(gameLoopCounter % pipeSpawnInterval === 0) { addPipe(); cleanPipes(); }
        if(gameLoopCounter % coinSpawnInterval === coinSpawnOffset) { addCoin(); cleanCoins(); }
        updateChaser();
        if(gameLoopCounter >= nextKolkarSpawn) { addKolkar(); nextKolkarSpawn = getKolkarSpawnTime(); }
        cleanKolkar();
        gameLoopCounter++;
      }

      function checkCollisions(){
        $('.Pipe').each(function(){ if(isIntersecting(Birdy.BirdyObject, $(this))) endGame(); });
      }
      function checkCoinCollisions(){
        $('.Coin').each(function(){
          if(isIntersecting(Birdy.BirdyObject, $(this))){
            $(this).remove(); pipeDuration *= 0.55; chaseSpeed -= 0.01; if(chaseSpeed < 0) chaseSpeed = 0;
            $('#SwipeGif').show(); setTimeout(() => $('#SwipeGif').hide(), 2500);
          }
        });
      }
      function checkKolkarCollisions(){
        $('.Kolkar').each(function(){ if(isIntersecting(Birdy.BirdyObject, $(this))) endGame(); });
      }

      function isIntersecting(obj1, obj2){
        var o1 = [obj1.offset().left, obj1.offset().top, obj1.offset().left + obj1.width(), obj1.offset().top + obj1.height()];
        var o2 = [obj2.offset().left, obj2.offset().top, obj2.offset().left + obj2.width(), obj2.offset().top + obj2.height()];
        return !(o1[3] < o2[1] || o1[1] > o2[3] || o1[0] > o2[2] || o1[2] < o2[0]);
      }
      function isInBound(birdy, canvas){
        if(birdy.offset().top + birdy.height() > canvas.height() || birdy.offset().top < 0) endGame();
      }
      function incrementScore(){
        $('.Pipe').each(function(){
          if(!$(this).hasClass('TopPipe') && !$(this).data('scored') && Birdy.BirdyObject.offset().left + Birdy.BirdyObject.width() > $(this).offset().left + $(this).width()){
            CurrentScore++; $(this).data('scored', true);
            if(CurrentScore === 1 && !isMuted) startJammerFadeIn();
          }
        });
        $('#CurrentScore').text(CurrentScore);
      }

      function getTopPercent($el){
        var parent = $el.parent(), parentTop = parent.offset().top, parentHeight = parent.height(), elTop = $el.offset().top;
        return 100 * (elTop - parentTop) / parentHeight;
      }

      function setCookie(cname, cvalue, exdays){
        var d = new Date(); d.setTime(d.getTime() + (exdays*24*60*60*1000));
        document.cookie = cname + "=" + cvalue + "; expires=" + d.toUTCString();
      }
      function getCookie(cname){
        var name = cname + "=", ca = document.cookie.split(';');
        for(var i = 0; i < ca.length; i++) {
          var c = ca[i].trim(); if(c.indexOf(name) === 0) return c.substring(name.length, c.length);
        }
        return "";
      }

      $.fn.rotate = function(deg){
        return this.css({ 'transform': 'rotate('+deg+'deg)', '-webkit-transform': 'rotate('+deg+'deg)', '-moz-transform': 'rotate('+deg+'deg)' });
      };

      $('#InstructionBox').slideDown(); setTimeout(() => $('#InstructionBox').slideUp(), 4000);
      nextKolkarSpawn = getKolkarSpawnTime();
      canvasObject.mousedown(() => Birdy.jump());
      $('body').keydown(function(e){
        if(e.which === 32) resetGame();
        if(e.which === 80) togglePause();
      });
      $('#PauseButton').mousedown(function(e){ e.stopPropagation(); togglePause(); });
      $('#ResetButton').click(resetGame);

      startGame();
    });
  </script>
</body>
</html>
