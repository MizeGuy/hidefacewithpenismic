<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightning Chase Survival</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #Canvas {
            position: relative;
            width: 100%;
            height: 100%;
            cursor: default;
        }

        #ManaBarContainer {
            position: absolute;
            top: 2vh;
            left: 50%;
            transform: translateX(-50%);
            width: 50vw;
            height: 3vh;
            background: rgba(0,0,0,0.7);
            border: 2px solid #00ffff;
            border-radius: 15px;
            overflow: hidden;
            z-index: 200;
        }
        #ManaBar {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #00b7eb);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #00ffff;
        }

        #Header {
            position: absolute;
            top: 6vh;
            left: 50%;
            transform: translateX(-50%);
            color: #00ffff;
            font-weight: bold;
            font-size: 1.5vw;
            text-shadow: 0 0 5px #00ffff;
            z-index: 9999;
        }

        #Birdy {
            position: absolute;
            top: 40%;
            left: 20%;
            width: 15vw;
            height: 8.44vh;
            max-width: 200px;
            max-height: 112px;
            min-width: 50px;
            min-height: 28px;
            background-image: url('main/player.avif');
            background-size: cover;
            z-index: 150;
            transition: transform 0.1s ease;
        }
        .stunned {
            filter: brightness(0.5) blur(2px);
            animation: shake 0.2s infinite;
        }
        @keyframes shake {
            0% { transform: translate(2px, 1px); }
            50% { transform: translate(-2px, -1px); }
            100% { transform: translate(2px, 1px); }
        }

        .Coin {
            position: absolute;
            width: 8vw;
            height: 6vh;
            max-width: 120px;
            max-height: 90px;
            background-image: url('main/boostlogo.png');
            background-size: cover;
            left: 100%;
            z-index: 140;
            animation: CoinMovement 5s linear, glow 1s infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 5px gold; }
            to { box-shadow: 0 0 15px gold; }
        }

        .LightningBolt {
            position: absolute;
            width: 5vw;
            height: 20vh;
            background: linear-gradient(0deg, transparent, #00ffff, transparent);
            opacity: 0.7;
            z-index: 145;
            animation: boltFade 0.5s linear;
            box-shadow: 0 0 10px #00ffff;
        }
        .LightningWall {
            position: absolute;
            width: 8vw;
            height: 100vh;
            left: 100%;
            background: repeating-linear-gradient(0deg, #00ffff 0%, #00ffff 10%, transparent 10%, transparent 20%);
            opacity: 0.8;
            z-index: 148;
            animation: WallMovement 4s linear;
            box-shadow: 0 0 15px #00ffff;
        }
        @keyframes WallMovement { from { left: 100%; } to { left: -10%; } }
        @keyframes CoinMovement { from { left: 100%; } to { left: -10%; } }
        @keyframes boltFade { 0% { opacity: 0.7; } 100% { opacity: 0; } }

        #CurrentScoreCard {
            position: absolute;
            left: 2vw;
            top: 2vh;
            font-size: 2vw;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
            z-index: 50;
            pointer-events: none;
        }

        #LostScoreScreen {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            padding: 2vw;
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ffff;
            border-radius: 10px;
            text-align: center;
            display: none;
            font-size: 1.8vw;
            color: #00ffff;
            z-index: 150;
            width: 35vw;
            max-width: 450px;
            box-shadow: 0 0 20px #00ffff;
        }
        #FinalScore, #BestScore {
            font-weight: bold;
            font-size: 2.5vw;
            text-shadow: 0 0 10px #00ffff;
        }
        #ResetButton {
            background: #00ffff;
            border: none;
            padding: 1vh 2vw;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.5vw;
            color: #1a1a2e;
            transition: transform 0.2s;
        }
        #ResetButton:hover {
            transform: scale(1.05);
        }

        #PauseButton {
            position: absolute;
            top: 2vh;
            right: 1vw;
            width: 3vw;
            max-width: 40px;
            background: #00ffff;
            border-radius: 0.5vw;
            font-size: 2vw;
            text-align: center;
            z-index: 50;
            cursor: pointer;
            padding: 0.5vh 0;
            box-shadow: 0 0 10px #00ffff;
            transition: transform 0.2s;
        }
        #PauseButton:hover {
            transform: scale(1.1);
        }

        #Chaser {
            position: absolute;
            top: 40%;
            left: -5%;
            width: 20vw;
            height: 20vh;
            max-width: 250px;
            max-height: 250px;
            background-image: url('main/chaser.JPG');
            background-size: cover;
            z-index: 100;
            filter: drop-shadow(0 0 10px #ff00ff);
        }

        .Kolkar {
            position: absolute;
            width: 20vw;
            height: 17.5vh;
            max-width: 250px;
            max-height: 218px;
            background-image: url('main/kolkar.png');
            background-size: cover;
            left: 100%;
            z-index: 160;
            animation: KolkarMovement 5s linear;
        }
        @keyframes KolkarMovement { from { left: 100%; } to { left: -15%; } }
        .paused { animation-play-state: paused; }
    </style>
</head>
<body>
    <div id="ManaBarContainer"><div id="ManaBar"></div></div>
    <div id="Header">Made By TheMizeGuy</div>
    <div id="Canvas">
        <div id="CurrentScoreCard" class="noSelect"><span id="CurrentScore">0</span></div>
        <div id="LostScoreScreen" class="noSelect">
            <span>Distance Survived</span><br><span id="FinalScore">0</span><br>
            <span>Best</span><br><span id="BestScore">0</span><br><br>
            <button id="ResetButton" type="button">Reset</button>
        </div>
        <div id="Birdy"></div>
        <div id="PauseButton" class="noSelect">||</div>
        <div id="Chaser"></div>
    </div>

    <script src="main/jquery.min.js"></script>
    <script>
        $(function() {
            // Core game variables
            const canvasObject = $('#Canvas');
            let gameLoopIntervalID = 0;
            let Paused = true;
            let Lost = false;
            let CurrentScore = 0;
            let gameLoopCounter = 0;
            const basePlayerSpeed = 0.25;
            let baseChaseSpeed = 0.2;
            const maxMana = 100;
            let currentMana = maxMana;
            let stunned = false;
            let stunDuration = 0;

            // Audio setup
            const coinSound = new Audio('main/coin.mp3'); coinSound.volume = 0.1;
            const lightningSound = new Audio('main/lightning.mp3'); lightningSound.volume = 0.3;
            const hitSound = new Audio('main/hit.mp3'); hitSound.volume = 0.4;
            const deathSound = new Audio('main/death.mp3'); deathSound.volume = 0.7;
            const jammerSound = new Audio('main/jammer.mp3'); 
            jammerSound.loop = true;
            let jammerFadeInterval = null;

            // Player object
            const Birdy = {
                selectorObject: $('#Birdy'),
                gravVeloc: 0,
                gravAccel: 0.35,
                terminalVelocity: 12,
                reset() {
                    this.gravVeloc = 0;
                    stunned = false;
                    currentMana = maxMana;
                    this.selectorObject.removeClass('stunned').css({ top: '40%', left: '20%' });
                    updateManaBar();
                },
                fall() {
                    if (!stunned && !Paused) {
                        const newTop = this.getTopPercent() + this.gravVeloc;
                        this.selectorObject.css('top', clamp(newTop, 0, 90) + '%');
                        this.gravVeloc = Math.min(this.gravVeloc + this.gravAccel, this.terminalVelocity);
                    }
                },
                jump() {
                    if (Paused || stunned) return;
                    this.gravVeloc = -8;
                },
                move() {
                    if (!stunned && !Paused) {
                        const currentLeft = this.getLeftPercent();
                        this.selectorObject.css('left', (currentLeft + basePlayerSpeed) + '%');
                    }
                },
                getTopPercent() { return parseFloat(this.selectorObject.css('top')) / $(window).height() * 100; },
                getLeftPercent() { return parseFloat(this.selectorObject.css('left')) / $(window).width() * 100; }
            };

            // Game state management
            function startGame() {
                if (Lost) return;
                gameLoopIntervalID = setInterval(gameLoop, 30);
                $('.Coin, .LightningWall, .Kolkar').removeClass('paused');
                $('#PauseButton').text('||');
                Paused = false;
                startJammerFade();
            }

            function pauseGame() {
                clearInterval(gameLoopIntervalID);
                $('.Coin, .LightningWall, .Kolkar').addClass('paused');
                $('#PauseButton').text('â–¶');
                Paused = true;
                jammerSound.pause();
            }

            function togglePause() { Paused ? startGame() : pauseGame(); }

            function endGame() {
                Lost = true;
                pauseGame();
                const highScore = Math.max(CurrentScore, parseInt(getCookie('HighScore') || 0));
                setCookie('HighScore', highScore, 9999);
                $('#FinalScore').text(CurrentScore);
                $('#BestScore').text(highScore);
                $('#LostScoreScreen').fadeIn(300);
                deathSound.play();
                clearInterval(jammerFadeInterval);
                jammerSound.pause();
            }

            function resetGame() {
                pauseGame();
                $('.Coin, .LightningBolt, .LightningWall, .Kolkar').remove();
                Lost = false;
                CurrentScore = 0;
                gameLoopCounter = 0;
                baseChaseSpeed = 0.2;
                $('#Chaser').css({ left: '-5%', top: '40%' });
                Birdy.reset();
                $('#LostScoreScreen').fadeOut(300);
                nextLightningWallSpawn = 100;
                nextKolkarSpawn = 150;
                clearInterval(jammerFadeInterval);
                jammerSound.currentTime = 0;
                startGame();
            }

            // Audio management
            function startJammerFade() {
                jammerSound.volume = 0;
                jammerSound.play();
                const fadeDuration = 20000; // 20 seconds
                const maxVolume = 0.2;
                const steps = 100;
                const stepTime = fadeDuration / steps;
                const volIncrement = maxVolume / steps;
                
                clearInterval(jammerFadeInterval);
                jammerFadeInterval = setInterval(() => {
                    if (Paused || Lost) {
                        clearInterval(jammerFadeInterval);
                        return;
                    }
                    const newVol = Math.min(jammerSound.volume + volIncrement, maxVolume);
                    jammerSound.volume = newVol;
                    if (newVol >= maxVolume) clearInterval(jammerFadeInterval);
                }, stepTime);
            }

            // Game elements
            function updateManaBar() {
                $('#ManaBar').css('width', (currentMana / maxMana * 100) + '%');
                if (currentMana <= 0) endGame();
            }

            function addCoin() {
                $('<div/>').addClass('Coin').css({ top: 20 + Math.random() * 50 + '%' }).appendTo(canvasObject);
            }

            function addLightningBolt() {
                const chaserTop = parseFloat($('#Chaser').css('top'));
                const bolt = $('<div/>').addClass('LightningBolt')
                    .css({
                        left: $('#Chaser').offset().left + $('#Chaser').width(),
                        top: chaserTop + (Math.random() - 0.5) * 20 + '%'
                    })
                    .appendTo(canvasObject);
                bolt.animate({ left: Birdy.selectorObject.offset().left }, 500, 'linear', function() { $(this).remove(); });
                lightningSound.currentTime = 0;
                lightningSound.play();
            }

            let nextLightningWallSpawn = 100;
            function addLightningWall() {
                const gapHeight = 25;
                const gapTop = Math.random() * (70 - gapHeight) + 10;
                const wall = $('<div/>').addClass('LightningWall').css('top', '0%').appendTo(canvasObject);
                wall.data({ gapTop, gapHeight });
                lightningSound.currentTime = 0;
                lightningSound.play();
            }

            let nextKolkarSpawn = 150;
            function addKolkar() {
                $('<div/>').addClass('Kolkar').css('top', 10 + Math.random() * 60 + '%').appendTo(canvasObject);
            }

            function updateChaser() {
                if (!Lost && !Paused) {
                    const playerLeft = Birdy.getLeftPercent();
                    const chaseLeft = parseFloat($('#Chaser').css('left')) / $(window).width() * 100;
                    const distanceFactor = Math.max(0, 1 - (playerLeft - chaseLeft) / 50);
                    const adjustedChaseSpeed = baseChaseSpeed * (0.7 + 0.3 * distanceFactor);
                    
                    const newChaseLeft = chaseLeft + adjustedChaseSpeed;
                    const birdTop = Birdy.getTopPercent();
                    const chaseTop = parseFloat($('#Chaser').css('top'));
                    const diff = birdTop - chaseTop;
                    
                    $('#Chaser').css({
                        left: newChaseLeft + '%',
                        top: (chaseTop + diff * 0.05) + '%'
                    });

                    if (isIntersecting(Birdy.selectorObject, $('#Chaser'))) endGame();
                }
            }

            // Main game loop
            function gameLoop() {
                if (stunDuration > 0) {
                    stunDuration--;
                    if (stunDuration <= 0) Birdy.selectorObject.removeClass('stunned');
                }

                Birdy.move();
                Birdy.fall();
                updateChaser();
                CurrentScore = Math.floor(gameLoopCounter / 10);
                $('#CurrentScore').text(CurrentScore);

                if (gameLoopCounter % 50 === 0) addCoin();
                if (gameLoopCounter % 20 === 0) addLightningBolt();
                if (gameLoopCounter >= nextLightningWallSpawn) {
                    addLightningWall();
                    nextLightningWallSpawn = gameLoopCounter + 80 + Math.random() * 40;
                }
                if (gameLoopCounter >= nextKolkarSpawn) {
                    addKolkar();
                    nextKolkarSpawn = gameLoopCounter + 100 + Math.random() * 50;
                }

                checkCollisions();
                currentMana -= 0.1;
                updateManaBar();
                gameLoopCounter++;
            }

            // Collision detection
            function checkCollisions() {
                $('.Coin').each(function() {
                    if (isIntersecting(Birdy.selectorObject, $(this))) {
                        $(this).remove();
                        currentMana = Math.min(maxMana, currentMana + 20);
                        coinSound.currentTime = 0;
                        coinSound.play();
                    }
                });

                $('.LightningBolt').each(function() {
                    if (isIntersecting(Birdy.selectorObject, $(this)) && !stunned) {
                        currentMana -= 15;
                        stunned = true;
                        stunDuration = 20;
                        Birdy.selectorObject.addClass('stunned');
                        hitSound.play();
                        $(this).remove();
                    }
                });

                $('.LightningWall').each(function() {
                    if (isIntersecting(Birdy.selectorObject, $(this))) {
                        const birdTop = Birdy.getTopPercent();
                        const { gapTop, gapHeight } = $(this).data();
                        if (birdTop < gapTop || birdTop > gapTop + gapHeight) {
                            currentMana -= 30;
                            stunned = true;
                            stunDuration = 30;
                            Birdy.selectorObject.addClass('stunned');
                            hitSound.play();
                        }
                    }
                });

                $('.Kolkar').each(function() {
                    if (isIntersecting(Birdy.selectorObject, $(this))) {
                        currentMana -= 40;
                        stunned = true;
                        stunDuration = 40;
                        Birdy.selectorObject.addClass('stunned');
                        hitSound.play();
                        $(this).remove();
                    }
                });

                $('.Coin, .LightningBolt, .LightningWall, .Kolkar').filter((_, el) => $(el).offset().left < -$(el).width()).remove();
            }

            // Utility functions
            function isIntersecting(obj1, obj2) {
                const o1 = obj1[0].getBoundingClientRect();
                const o2 = obj2[0].getBoundingClientRect();
                return !(o1.bottom < o2.top || o1.top > o2.bottom || o1.right < o2.left || o1.left > o2.right);
            }

            function clamp(value, min, max) {
                return Math.max(min, Math.min(max, value));
            }

            function setCookie(name, value, days) {
                const d = new Date();
                d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
                document.cookie = `${name}=${value}; expires=${d.toUTCString()}; path=/`;
            }

            function getCookie(name) {
                return document.cookie.split('; ').reduce((acc, cookie) => {
                    const [key, val] = cookie.split('=');
                    return key === name ? val : acc;
                }, '');
            }

            // Event handlers
            canvasObject.on('mousedown', e => {
                e.preventDefault();
                Birdy.jump();
            });

            $(document).on('keydown', e => {
                if (e.which === 32) resetGame();
                if (e.which === 80) togglePause();
            });

            $('#PauseButton').on('mousedown', e => {
                e.stopPropagation();
                e.preventDefault();
                togglePause();
            });

            $('#ResetButton').on('click', resetGame);

            // Initialize game
            startGame();
        });
    </script>
</body>
</html>
